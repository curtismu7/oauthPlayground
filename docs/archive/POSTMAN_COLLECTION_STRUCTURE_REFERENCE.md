# Postman Collection Structure Reference

This document provides a complete reference of all groups, subgroups, and API calls in the PingOne Postman collections generated by OAuth Playground. This structure is the **canonical reference** for what should be generated. Once stable, this document will be used as part of the restore process.

**Version:** Collections are versioned (e.g., `9.0.0`) to track changes and updates. Check the collection info for the current version when troubleshooting.

## Table of Contents

1. [Worker Token](#worker-token)
2. [Use Cases](#use-cases)
3. [Unified OAuth/OIDC Flows](#unified-oauthoidc-flows)
4. [MFA Flows](#mfa-flows)

---

## Worker Token

**Location:** Top-level folder (appears first in all collections)

**Purpose:** Server-to-server authentication tokens required for administrative operations

**Scope:** `openid` (all methods)

### Subgroups:

#### 1. Get Worker Token (Client Secret Post)
- **Get Worker Token** - POST request to obtain worker token using `client_id` and `client_secret` in request body (form-urlencoded)
  - Endpoint: `POST {{authPath}}/{{envID}}/as/token`
  - Content-Type: `application/x-www-form-urlencoded`
  - Body: `grant_type=client_credentials&scope=openid&client_id={{worker_client_id}}&client_secret={{worker_client_secret}}`

#### 2. Get Worker Token (Client Secret Basic)
- **Get Worker Token** - POST request to obtain worker token using HTTP Basic Authentication
  - Endpoint: `POST {{authPath}}/{{envID}}/as/token`
  - Authorization: `Basic {{user_client_credentials_basic}}` (base64 encoded `client_id:client_secret`)
  - Body: `grant_type=client_credentials&scope=openid`

#### 3. Get Worker Token (Client Secret JWT)
- **Get Worker Token** - POST request to obtain worker token using JWT assertion signed with client secret
  - Endpoint: `POST {{authPath}}/{{envID}}/as/token`
  - Pre-request script generates JWT assertion with HS256 signature
  - Body: `grant_type=client_credentials&scope=openid&client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer&client_assertion={{client_assertion_jwt}}`

#### 4. Get Worker Token (Private Key JWT)
- **Get Worker Token** - POST request to obtain worker token using JWT assertion signed with private key
  - Endpoint: `POST {{authPath}}/{{envID}}/as/token`
  - Body: `grant_type=client_credentials&scope=openid&client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer&client_assertion={{client_assertion_jwt_private}}`

**Default Worker Credentials:**
- `worker_client_id`: `66a4686b-9222-4ad2-91b6-03113711c9aa` (hardcoded, never overridden)
- `worker_client_secret`: `3D_ksu7589TfcVJm2fqEHjXuhc-DCRfoxEv0urEw8GIK7qiJe72n92WRQ0uaT2tC` (hardcoded, never overridden)

---

## Use Cases

**Location:** Top-level folder (after Worker Token)

**Purpose:** Common customer identity flows for web applications

**Collection Name:** `PingOne Customer Identity Use Cases`

### Use Case Structure

Each use case follows this structure (where applicable):
- **Environment Configuration** - Setup steps (populations, groups, policies, applications)
- **Configure Your Test User** - User creation, lookup, and configuration
- **Test The Workflow** - Actual workflow execution

### Subgroups:

#### 1. Sign-up (Registration)
**Structure:** Environment Configuration → Configure Your Test User → Test The Workflow

**Environment Configuration:**
- **Step 1: Create a population for sign-up users**
  - `POST {{apiPath}}/v1/environments/{{envID}}/populations`
  - Creates population: `SignUpPopulation_{{$timestamp}}`
  - Saves `SignUpPopID`

- **Step 2: Create a group for sign-up users**
  - `POST {{apiPath}}/v1/environments/{{envID}}/groups`
  - Content-Type: `application/vnd.pingidentity.group+json`
  - Creates group: `SignUpGroup_{{$timestamp}}`
  - Assigns to `{{SignUpPopID}}`
  - Saves `groupId`

**Configure Your Test User:**
- **Step 1: Lookup User by Username/Email**
  - `GET {{apiPath}}/v1/environments/{{envID}}/users?filter=username eq "{{username}}"`
  - Pre-request: Generates random baseball player username/email
  - Saves `username` if user not found

- **Step 2: Create a user**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users`
  - Content-Type: `application/vnd.pingidentity.user.import+json`
  - Pre-request: Random baseball player data (`SignUpFirstName`, `SignUpLastName`, `SignUpUsername`, `SignUpEmail`)
  - Email format: `cmuir+{firstName}@pingone.com`
  - Sets `lifecycle.status: "VERIFICATION_REQUIRED"` and `lifecycle.suppressVerificationCode: false`
  - Automatically sends verification email
  - Saves `SignUpUserID` and `SignUpUsername`

- **Step 3: Verify User**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{SignUpUserID}}`
  - Content-Type: `application/vnd.pingidentity.user.verify+json`
  - Pre-request: Instructs user to enter OTP code from email
  - Body: `{"verificationCode": "{{emailVerificationCode}}"}`

- **Step 4: Set user password**
  - `PUT {{apiPath}}/v1/environments/{{envID}}/users/{{SignUpUserID}}/password`
  - Content-Type: `application/vnd.pingidentity.password.reset+json`
  - Pre-request: Generates password (`2Federate!` + random 4-digit suffix)
  - Body: `{"newPassword": "{{userPassword}}"}`

- **Step 5: Add User to Group**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{SignUpUserID}}/memberOfGroups`
  - Body: `{"id": "{{groupId}}"}`

**Test The Workflow:**
- **Step 1: Lookup User by Username**
  - `GET {{apiPath}}/v1/environments/{{envID}}/users?filter=username eq "{{SignUpUsername}}"`
  - Verifies user was created and can be found by username
  - Validates sign-up workflow completed successfully

- **Step 2: Lookup User by Email**
  - `GET {{apiPath}}/v1/environments/{{envID}}/users?filter=email eq "{{SignUpEmail}}"`
  - Verifies user was created and can be found by email
  - Confirms email verification was completed

- **Step 3: Lookup User by User ID**
  - `GET {{apiPath}}/v1/environments/{{envID}}/users/{{SignUpUserID}}`
  - Direct lookup to verify user details
  - Validates all user properties are set correctly

#### 2. Sign-in
**Structure:** Environment Configuration → Configure Your Test User → Test The Workflow

**Environment Configuration:**
- **Step 1: Create a web application**
  - `POST {{apiPath}}/v1/environments/{{envID}}/applications`
  - **IMPORTANT:** The `redirectUris` property is required and must contain at least one valid redirect URI
  - Default redirect URI: `https://localhost:3000/postman-callback` (recommended for Postman testing)
  - **Redirect URI Options:**
    - `https://localhost:3000/postman-callback` - Recommended for Postman collection testing
    - `https://oauth.pstmn.io/v1/callback` - Postman desktop OAuth helper
    - `https://oauth.pstmn.io/v1/browser-callback` - Postman web/browser OAuth helper
  - **Note:** The redirect URI must be registered in your PingOne application's redirect URIs list
  - Creates: `WebAppSignInWithPKCE_{{$timestamp}}`
  - Sets `pkceEnforcement: "S256_REQUIRED"`
  - Includes `redirectUris: ["{{redirect_uri}}"]` in request body
  - Pre-request script validates and sets default redirect URI if not set
  - Saves `webAppSignInWithPKCEId`

- **Step 2: Get the application secret**
  - `GET {{apiPath}}/v1/environments/{{envID}}/applications/{{webAppSignInWithPKCEId}}/secret`
  - Saves `SignInWithPKCEAppSecret`

- **Step 3: Create a sign-on policy**
  - `POST {{apiPath}}/v1/environments/{{envID}}/signOnPolicies`
  - Creates: `SignIn_UseCasePolicy_{{$timestamp}}`
  - Saves `SignInSignonPolicyID`

- **Step 4: Create the login sign-on policy action**
  - `POST {{apiPath}}/v1/environments/{{envID}}/signOnPolicies/{{SignInSignonPolicyID}}/actions`
  - Body: `{"priority": 1, "type": "LOGIN"}`
  - Saves `signInLoginPolicyActionID`

- **Step 5: Assign the sign-on policy to the web application**
  - `POST {{apiPath}}/v1/environments/{{envID}}/applications/{{webAppSignInWithPKCEId}}/signOnPolicyAssignments`
  - Body: `{"priority": 1, "signOnPolicy": {"id": "{{SignInSignonPolicyID}}"}}`

**Configure Your Test User:**
- **Step 1: Create a population for sign-in users**
  - `POST {{apiPath}}/v1/environments/{{envID}}/populations`
  - Creates: `SignInPopulation_{{$timestamp}}`
  - Saves `SignInPopID`

- **Step 2: Create a user**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users`
  - Pre-request: Random baseball player data (`SignInFirstName`, `SignInLastName`, `SignInUsername`, `SignInEmail`)
  - Email format: `cmuir+{firstName}@pingone.com`
  - Saves `SignInUserID` and `SignInUsername`

- **Step 3: Set user password**
  - `PUT {{apiPath}}/v1/environments/{{envID}}/users/{{SignInUserID}}/password`
  - Content-Type: `application/vnd.pingidentity.password.reset+json`
  - Pre-request: Generates password (`2Federate!` + random 4-digit suffix)
  - Body: `{"newPassword": "{{userPassword}}"}`

**Test The Workflow:**
- **Step 1: Send an authorization request**
  - `GET {{authPath}}/{{envID}}/as/authorize?...&response_mode=pi.flow`
  - Returns JSON flow response (no redirect)
  - Saves `flowID` from response `id` field or Location header
  - Reference: [PingOne Getting Started - Step 4: Send an authorization request](https://apidocs.pingidentity.com/pingone/getting-started/v1/api/#get-step-4-send-an-authorization-request)

- **Step 2: Get the flow**
  - `GET {{authPath}}/{{envID}}/flows/{{flowID}}`
  - Retrieves flow resource to check current status
  - Response indicates next action required (e.g., `USERNAME_PASSWORD_REQUIRED`, `COMPLETED`)
  - Saves `resumeUrl` if available
  - Reference: [PingOne Getting Started - Step 5: Get the flow](https://apidocs.pingidentity.com/pingone/getting-started/v1/api/#get-step-5-get-the-flow)

- **Step 3: Submit login credentials**
  - `POST {{authPath}}/{{envID}}/flows/{{flowID}}`
  - Content-Type: `application/vnd.pingidentity.usernamePassword.check+json`
  - Body: `{"username": "{{SignInUsername}}", "password": "{{userPassword}}"}`
  - Reference: [PingOne Getting Started - Step 6: Submit login credentials](https://apidocs.pingidentity.com/pingone/getting-started/v1/api/#post-step-6-submit-login-credentials)

- **Step 4: Call the resume endpoint**
  - `GET {{authPath}}/{{envID}}/as/resume?flowId={{flowID}}`
  - Gets authorization code from Location header or JSON response
  - Saves `authorization_code` (or `authCode`)
  - Reference: [PingOne Getting Started - Step 7: Call the resume endpoint](https://apidocs.pingidentity.com/pingone/getting-started/v1/api/#get-step-7-call-the-resume-endpoint)

- **Step 5: Get the access token**
  - `POST {{authPath}}/{{envID}}/as/token`
  - Content-Type: `application/x-www-form-urlencoded`
  - Body: `grant_type=authorization_code&code={{authCode}}&redirect_uri={{redirect_uri}}&code_verifier={{codeVerifier}}`
  - Exchanges authorization code for tokens
  - Saves `access_token`, `id_token`, `refresh_token`
  - Reference: [PingOne Getting Started - Step 8: Get the access token](https://apidocs.pingidentity.com/pingone/getting-started/v1/api/#post-step-8-get-the-access-token)

**Complete Workflow Reference:** [PingOne Getting Started - Task 3: Create an SSO workflow](https://apidocs.pingidentity.com/pingone/getting-started/v1/api/#task-3-create-an-sso-workflow)

#### 3. MFA Enrollment
**Structure:** Environment Configuration → Configure Your Test User → Test The Workflow

**Environment Configuration:**
- **Step 1: Get Device Authentication Policies**
  - `GET {{apiPath}}/v1/environments/{{envID}}/deviceAuthenticationPolicies`
  - Saves first policy ID as `deviceAuthenticationPolicyId`

**Configure Your Test User:**
- **Step 1: Lookup User by Username**
  - `GET {{apiPath}}/v1/environments/{{envID}}/users?filter=username eq "{{username}}"`
  - Uses `{{access_token}}` for authorization
  - Saves `userId`

**Test The Workflow:**
- **Step 1: Create SMS Device**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/devices`
  - Body: `{"type": "SMS", "phone": "{{phone}}", "nickname": "My SMS Device", "status": "ACTIVATION_REQUIRED", "policy": {"id": "{{deviceAuthenticationPolicyId}}"}}`
  - Saves `deviceId`

- **Step 2: Activate Device with OTP**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/devices/{{deviceId}}`
  - Content-Type: `application/vnd.pingidentity.device.activate+json`
  - Body: `{"otp": "{{otp_code}}"}`

#### 4. MFA Challenge
**Structure:** Environment Configuration → Test The Workflow

**Environment Configuration:**
- **Step 1: Get Device Authentication Policies**
  - `GET {{apiPath}}/v1/environments/{{envID}}/deviceAuthenticationPolicies`
  - Saves first policy ID as `deviceAuthenticationPolicyId`

**Test The Workflow:**
- **Step 1: Initialize Device Authentication**
  - `POST {{apiPath}}/v1/environments/{{envID}}/deviceAuthentications`
  - Body: `{"user": {"id": "{{userId}}"}}`
  - Saves `deviceAuthenticationId`

- **Step 2: Validate OTP Code**
  - `POST {{apiPath}}/v1/environments/{{envID}}/deviceAuthentications/{{deviceAuthenticationId}}/otp/check`
  - Content-Type: `application/vnd.pingidentity.otp.check+json`
  - Body: `{"otp": "{{otp_code}}"}`

- **Step 3: Complete Device Authentication**
  - `POST {{apiPath}}/v1/environments/{{envID}}/deviceAuthentications/{{deviceAuthenticationId}}/complete`
  - Finalizes MFA authentication

#### 5. Step-up Authentication
**Note:** Placeholder - combines re-authentication + sensitive action
- Currently empty (`item: []`)

#### 6. Forgot Password / Password Reset
**Structure:** Flat structure (no subgroups)

- **Step 1: Lookup User by Username/Email**
  - `GET {{apiPath}}/v1/environments/{{envID}}/users?filter=username eq "{{username}}"`
  - Saves `userId`

- **Step 2: Send Recovery Code**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/password/recovery`
  - Content-Type: `application/vnd.pingidentity.password.sendRecoveryCode`
  - Body: `{}` (empty)

- **Step 3: Reset Password**
  - `PUT {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/password`
  - Content-Type: `application/vnd.pingidentity.password.reset+json`
  - Pre-request: Generates password (`2Federate!` + random 4-digit suffix)
  - Body: `{"newPassword": "{{newPassword}}"}`

#### 7. Account Recovery
**Structure:** Test The Workflow

**Test The Workflow:**
- **Step 1: Lookup User by Email**
  - `GET {{apiPath}}/v1/environments/{{envID}}/users?filter=email.address eq "{{email}}"`
  - Saves `userId`

- **Step 2: Send Recovery Code to Email**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/password/recovery`
  - Content-Type: `application/vnd.pingidentity.password.sendRecoveryCode`
  - Body: `{}` (empty)

- **Step 3: Validate Recovery Code**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/password`
  - Content-Type: `application/vnd.pingidentity.password.recover+json`
  - Pre-request: Generates password (`2Federate!` + random 4-digit suffix)
  - Body: `{"recoveryCode": "{{recoveryCode}}", "newPassword": "{{newPassword}}"}`

#### 8. Password recovery for user
**Structure:** Flat structure (no subgroups)

- **Step 1: Change Password (Self-Service)**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/password`
  - Content-Type: `application/vnd.pingidentity.password.change+json`
  - Uses `{{access_token}}` (user token, not worker token)
  - Pre-request: Generates password (`2Federate!` + random 4-digit suffix)
  - Body: `{"currentPassword": "{{currentPassword}}", "newPassword": "{{newPassword}}"}`

- **Step 2: Admin Force Password Change**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/password`
  - Content-Type: `application/vnd.pingidentity.password.forceChange`
  - Body: `{}` (empty)

#### 9. Social Login
**Structure:** Flat structure (no subgroups)

- **Step 1: Configure Facebook as External Identity Provider**
  - `POST {{apiPath}}/v1/environments/{{envID}}/externalIdps`
  - Body: Facebook IdP configuration
  - Saves `facebook_idp_id`

- **Step 2: Configure LinkedIn as External Identity Provider**
  - `POST {{apiPath}}/v1/environments/{{envID}}/externalIdps`
  - Body: LinkedIn IdP configuration
  - Saves `linkedin_idp_id`

#### 10. Partner / Enterprise Federation
**Structure:** Flat structure (no subgroups)

- **Step 1: Configure Azure AD as External Identity Provider**
  - `POST {{apiPath}}/v1/environments/{{envID}}/externalIdps`
  - Body: Azure AD IdP configuration (OPENID_CONNECT type)
  - Saves `azure_idp_id`

#### 11. Risk-based Checks
**Structure:** Flat structure (no subgroups)

- **Step 1: Get Risk Predictors**
  - `GET {{apiPath}}/v1/environments/{{envID}}/protect/v1/riskPredictors`
  - Saves first predictor ID as `riskPredictorId`

- **Step 2: Update Risk Evaluation**
  - `PATCH {{apiPath}}/v1/environments/{{envID}}/protect/v1/riskEvaluations/{{riskEvaluationId}}`
  - Body: `{"completionStatus": "{{completionStatus}}"}`

#### 12. Logout
**Structure:** Flat structure (no subgroups)

- **Step 1: Get User Sessions**
  - `GET {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/sessions`
  - Saves first session ID as `sessionId`

- **Step 2: Local Logout (End Session)**
  - `POST {{authPath}}/{{envID}}/as/session/end`
  - Content-Type: `application/x-www-form-urlencoded`
  - Body: `token={{access_token}}&token_type_hint=access_token`

- **Step 3: Revoke Refresh Token**
  - `POST {{authPath}}/{{envID}}/as/revoke`
  - Content-Type: `application/x-www-form-urlencoded`
  - Body: `token={{refresh_token}}&token_type_hint=refresh_token&client_id={{user_client_id}}`

- **Step 4: Delete Specific User Session**
  - `DELETE {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/sessions/{{sessionId}}`

- **Step 5: Introspect Token (Verify Token Status)**
  - `POST {{authPath}}/{{envID}}/as/introspect`
  - Content-Type: `application/x-www-form-urlencoded`
  - Body: `token={{access_token}}&token_type_hint=access_token`

#### 13. User Sessions
**Note:** Currently not implemented in code (placeholder)

#### 14. Transaction Approval
**Note:** Currently not implemented in code (placeholder)

#### 15. PingOne Metadata
**Note:** Currently not implemented in code (placeholder)

#### 16. OAuth Login
**Note:** Currently not implemented in code (placeholder)

---

## Unified OAuth/OIDC Flows

**Location:** Top-level folder (after Worker Token, before MFA Flows)

**Purpose:** Comprehensive OAuth 2.0 and OpenID Connect flows organized by specification version

**Collection Name:** `PingOne Unified OAuth/OIDC Flows - Complete Collection`

### Subgroups:

#### 1. OAuth 2.0 Authorization Framework (RFC 6749)
**Purpose:** Baseline OAuth framework standard (authorization without authentication)

**Flows Included:**

##### Authorization Code Flow (Client Secret Post)
- **1. Build Authorization URL**
  - `GET {{authPath}}/{{envID}}/as/authorize?client_id={{user_client_id}}&response_type=code&redirect_uri={{redirect_uri}}&scope={{scopes_oauth2}}&state={{state}}`
  - Response mode: `query` (default)

- **2. Exchange Authorization Code for Tokens**
  - `POST {{authPath}}/{{envID}}/as/token`
  - Content-Type: `application/x-www-form-urlencoded`
  - Body: `grant_type=authorization_code&code={{authorization_code}}&redirect_uri={{redirect_uri}}&client_id={{user_client_id}}&client_secret={{user_client_secret}}`
  - Extracts: `access_token` only (no `id_token`, no `refresh_token`)

- **3. Use Access Token (Optional - Call UserInfo or API)**
  - Optional step for demonstration

##### Authorization Code Flow (Client Secret Basic)
- Same structure as Client Secret Post, but uses Basic Auth header

##### Authorization Code Flow (Client Secret JWT)
- Same structure as Client Secret Post, but uses JWT assertion for client authentication

##### Authorization Code Flow (Private Key JWT)
- Same structure as Client Secret Post, but uses private key JWT assertion

##### Authorization Code Flow (Form POST)
- Same structure as Client Secret Post, but uses `response_mode=form_post`

##### Client Credentials Flow
- **Get Access Token**
  - `POST {{authPath}}/{{envID}}/as/token`
  - Content-Type: `application/x-www-form-urlencoded`
  - Body: `grant_type=client_credentials&scope={{scopes_oauth2}}&client_id={{user_client_id}}&client_secret={{user_client_secret}}`
  - Returns: `access_token` only (no `id_token`, no `refresh_token`)

##### Device Code Flow
- **1. Request Device Authorization**
  - `POST {{authPath}}/{{envID}}/as/device_authorization`
  - Body: `client_id={{user_client_id}}&scope={{scopes_oauth2}}`
  - Extracts: `device_code`, `user_code`, `verification_uri`, `expires_in`, `interval`

- **2. Poll for Token (repeat until user authorizes)**
  - `POST {{authPath}}/{{envID}}/as/token`
  - Body: `grant_type=urn:ietf:params:oauth:grant-type:device_code&device_code={{device_code}}&client_id={{user_client_id}}`
  - Polls at `{{device_code_interval}}` seconds until user authorizes

- **3. Use Access Token (Optional - Call UserInfo or API)**
  - Optional step

##### Implicit Flow
- **1. Build Authorization URL (Implicit)**
  - `GET {{authPath}}/{{envID}}/as/authorize?client_id={{user_client_id}}&response_type=token&redirect_uri={{redirect_uri}}&scope={{scopes_oauth2}}&state={{state}}&response_mode=fragment`
  - Returns `access_token` in URL fragment

- **2. Parse Redirect Callback (Demonstration Step)**
  - Demonstrates parsing fragment parameters

- **3. Use Access Token (Optional - Call UserInfo or API)**
  - Optional step

#### 2. OpenID Connect Core 1.0
**Purpose:** Authentication layer on top of OAuth 2.0 (adds ID tokens and user authentication)

**Flows Included:**

##### Authorization Code Flow with PKCE (Client Secret Post)
- **1. Generate PKCE Codes**
  - Pre-request script generates `code_verifier` and `code_challenge` (S256)

- **2. Build Authorization URL**
  - `GET {{authPath}}/{{envID}}/as/authorize?...&code_challenge={{code_challenge}}&code_challenge_method=S256`
  - Includes PKCE parameters

- **3. Exchange Authorization Code for Tokens**
  - `POST {{authPath}}/{{envID}}/as/token`
  - Body includes: `code_verifier={{code_verifier}}`
  - Extracts: `access_token`, `id_token`, `refresh_token`

- **4. Decode ID Token**
  - Demonstrates JWT decoding

- **5. Use Access Token (Optional - Call UserInfo)**
  - `GET {{authPath}}/{{envID}}/as/userinfo`

##### Authorization Code Flow with PKCE (Client Secret Basic)
- Same structure as Client Secret Post, but uses Basic Auth

##### Authorization Code Flow with PKCE (Client Secret JWT)
- Same structure as Client Secret Post, but uses JWT assertion

##### Authorization Code Flow with PKCE (Private Key JWT)
- Same structure as Client Secret Post, but uses private key JWT

##### Authorization Code Flow with PKCE and PAR (Client Secret Post)
- **1. Generate PKCE Codes**
- **2. Pushed Authorization Request (PAR)**
  - `POST {{authPath}}/{{envID}}/as/par`
  - Returns `request_uri`

- **3. Build Authorization URL (with request_uri)**
  - Uses `request_uri` instead of query parameters

- **4. Exchange Authorization Code for Tokens**
- **5. Decode ID Token**
- **6. Use Access Token (Optional - Call UserInfo)**

##### Authorization Code Flow with PKCE and PAR (Client Secret Basic)
- Same structure as PAR (Client Secret Post), but uses Basic Auth

##### Hybrid Flow
- **1. Build Authorization URL (Hybrid)**
  - `response_type=code id_token` or `code token` or `code id_token token`

- **2. Parse Redirect Callback (Demonstration Step)**
- **3. Exchange Authorization Code for Tokens**
- **4. Decode ID Token**
- **5. Use Access Token (Optional - Call UserInfo)**

#### 3. OAuth 2.1 Authorization Framework (draft) with OpenID Connect Core 1.0
**Purpose:** Consolidated OAuth specification (IETF draft) with modern security practices (PKCE required)

**Flows Included:**

##### Authorization Code Flow with PKCE (Client Secret Post)
- Same structure as OIDC Core 1.0 PKCE flow

##### Authorization Code Flow with PKCE (Client Secret Basic)
- Same structure as OIDC Core 1.0 PKCE flow

##### Authorization Code Flow with PKCE and PAR (Client Secret Post)
- Same structure as OIDC Core 1.0 PKCE + PAR flow

##### Authorization Code Flow with PKCE and PAR (Client Secret Basic)
- Same structure as OIDC Core 1.0 PKCE + PAR flow

**Note:** OAuth 2.1 does not support Implicit Flow or Client Credentials Flow in the same way as OAuth 2.0

#### 4. Redirectless (PingOne pi.flow)
**Purpose:** PingOne-specific redirectless authentication flow

**Flows Included:**

##### Redirectless Authentication Flow
- **1. Initialize Redirectless Flow**
  - `POST {{authPath}}/{{envID}}/as/authorize`
  - Content-Type: `application/x-www-form-urlencoded`
  - Body includes: `response_mode=pi.flow`
  - Returns JSON flow response (no redirect)

- **2. Authenticate User (Username/Password)**
  - `POST {{authPath}}/{{envID}}/flows/{{flowId}}`
  - Content-Type: `application/vnd.pingidentity.usernamePassword.check+json`

- **3. Handle MFA (if required)**
  - Device authentication steps if MFA is required

- **4. Complete Flow and Get Tokens**
  - `POST {{authPath}}/{{envID}}/flows/{{flowId}}/resume`
  - Gets tokens directly

- **5. Use Access Token (Optional - Call UserInfo)**
  - Optional step

---

## MFA Flows

**Location:** Top-level folder (after Unified OAuth/OIDC Flows)

**Purpose:** Multi-factor authentication device registration and authentication flows

**Collection Name:** `PingOne MFA Flows - Complete Collection`

### Subgroups:

#### 1. Registration
**Purpose:** Register MFA devices for users

**Device Types (each with their own subgroup):**

##### SMS
- **Create SMS Device (Admin Flow - ACTIVE status)**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/devices`
  - Body: `{"type": "SMS", "phone": "{{phone}}", "status": "ACTIVE", "policy": {"id": "{{deviceAuthenticationPolicyId}}"}}`
  - Uses worker token

- **Create SMS Device (User Flow - ACTIVATION_REQUIRED status)**
  - Same endpoint, but `status: "ACTIVATION_REQUIRED"`
  - Uses user access token

- **Activate SMS Device (with OTP)**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/devices/{{deviceId}}`
  - Content-Type: `application/vnd.pingidentity.device.activate+json`
  - Body: `{"otp": "{{otp_code}}"}`

- **Resend OTP Code**
  - Resend OTP for activation

##### EMAIL
- Same structure as SMS, but `type: "EMAIL"` and uses email address

##### WHATSAPP
- Same structure as SMS, but `type: "WHATSAPP"` and uses phone number

##### TOTP (OATH TOTP - RFC 6238)
- **Create TOTP Device (Admin Flow - ACTIVE status)**
- **Create TOTP Device (User Flow - ACTIVATION_REQUIRED status)**
- **Activate TOTP Device (with OTP)**
- **Get TOTP QR Code (for manual entry)**
  - `GET {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/devices/{{deviceId}}/qrcode`

##### FIDO2
- **Create FIDO2 Device (Admin Flow - ACTIVE status)**
- **Create FIDO2 Device (User Flow - ACTIVATION_REQUIRED status)**
- **Initialize FIDO2 Registration**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/devices/{{deviceId}}/fido2/initialize`
- **Complete FIDO2 Registration**
  - `POST {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}/devices/{{deviceId}}/fido2/complete`
  - Body includes FIDO2 assertion

##### MOBILE
- Same structure as SMS, but `type: "MOBILE"`

#### 2. Authentication
**Purpose:** Authenticate users using MFA devices

**Device Types (each with their own subgroup):**

##### SMS
- **Initialize Device Authentication**
  - `POST {{apiPath}}/v1/environments/{{envID}}/deviceAuthentications`
  - Body: `{"user": {"id": "{{userId}}"}}`

- **Validate OTP Code**
  - `POST {{apiPath}}/v1/environments/{{envID}}/deviceAuthentications/{{deviceAuthenticationId}}/otp/check`
  - Content-Type: `application/vnd.pingidentity.otp.check+json`
  - Body: `{"otp": "{{otp_code}}"}`

- **Complete Device Authentication**
  - `POST {{apiPath}}/v1/environments/{{envID}}/deviceAuthentications/{{deviceAuthenticationId}}/complete`

##### EMAIL
- Same structure as SMS

##### WHATSAPP
- Same structure as SMS

##### TOTP (OATH TOTP - RFC 6238)
- Same structure as SMS

##### FIDO2
- **Initialize Device Authentication**
- **Complete FIDO2 Authentication (with assertion)**
  - `POST {{apiPath}}/v1/environments/{{envID}}/deviceAuthentications/{{deviceAuthenticationId}}/fido2/complete`
  - Body includes FIDO2 assertion

##### MOBILE
- Same structure as SMS

---

## Collection Types

Collections can be generated in different combinations:

1. **Use Cases Only** - Worker Token + Use Cases
2. **Unified Only** - Worker Token + Unified OAuth/OIDC Flows
3. **MFA Only** - Worker Token + MFA Flows
4. **Complete (Unified + MFA)** - Worker Token + Unified OAuth/OIDC Flows + MFA Flows
5. **Complete (All)** - Worker Token + Use Cases + Unified OAuth/OIDC Flows + MFA Flows

---

## Key Features

### Random Data Generation

**Baseball Player Usernames:**
- Pre-request scripts randomly select from 15 historical baseball players
- Sets variables: `{prefix}FirstName`, `{prefix}LastName`, `{prefix}Username`, `{prefix}Email`
- Email format: `cmuir+{firstName}@pingone.com`
- Username format: `{player_username}_{timestamp}`

**Password Generation:**
- Default base: `"2Federate!"`
- Random 4-digit suffix (1000-9999)
- Example: `2Federate!4523`
- Sets both `userPassword` and `newPassword` variables

### Automatic Variable Extraction

All IDs, tokens, and values are automatically extracted and saved:
- User IDs (`SignUpUserID`, `SignInUserID`, `userId`)
- Device IDs (`deviceId`)
- Tokens (`workerToken`, `access_token`, `id_token`, `refresh_token`)
- Authorization codes (`authorization_code`)
- Session IDs (`sessionId`)
- Policy IDs (`SignInSignonPolicyID`, `deviceAuthenticationPolicyId`)
- And 50+ more variables

### Educational Comments

Each request includes:
- Markdown-formatted descriptions
- Educational context explaining what the endpoint does
- API documentation links
- Variable usage information
- Prerequisites and next steps

### Pre-Request Scripts

Types of pre-request scripts:
- Random data generation (usernames, passwords)
- JWT assertion generation (Client Secret JWT)
- PKCE code generation
- Variable setup
- User instructions (e.g., "Enter OTP code from email")

### Test Scripts

Every request includes test scripts that:
- Validate response status codes
- Extract and save variables automatically
- Provide helpful console messages
- Handle errors gracefully

---

## Content-Type Headers Reference

### User Operations
- Create User (Import): `application/vnd.pingidentity.user.import+json`
- Verify User: `application/vnd.pingidentity.user.verify+json`

### Password Operations
- Set Password: `application/vnd.pingidentity.password.set+json`
- Reset Password: `application/vnd.pingidentity.password.reset+json`
- Change Password: `application/vnd.pingidentity.password.change+json`
- Recover Password: `application/vnd.pingidentity.password.recover+json`
- Send Recovery Code: `application/vnd.pingidentity.password.sendRecoveryCode` (no body)
- Force Password Change: `application/vnd.pingidentity.password.forceChange` (no body)

### MFA Operations
- Activate Device: `application/vnd.pingidentity.device.activate+json`
- Select Device: `application/vnd.pingidentity.device.select+json`
- Check OTP: `application/vnd.pingidentity.otp.check+json`

### Authentication Operations
- Username/Password Check: `application/vnd.pingidentity.usernamePassword.check+json`

### Group Operations
- Create Group: `application/vnd.pingidentity.group+json`

---

## Redirect URI Configuration

### Default Redirect URI

**Default Value:** `https://localhost:3000/postman-callback`

This is the recommended redirect URI for Postman collection testing. It is automatically set as the default value for the `redirect_uri` environment variable.

### Redirect URI Options

When creating applications or using OAuth flows, you can use one of these redirect URIs:

1. **Postman Collection Testing (Recommended):**
   - `https://localhost:3000/postman-callback`
   - Use this for manual testing with Postman collections
   - Must be registered in your PingOne application's redirect URIs list

2. **Postman OAuth Helper (Desktop):**
   - `https://oauth.pstmn.io/v1/callback`
   - Use this if you're using Postman's built-in OAuth helper (desktop app)
   - Requires registration with Postman OAuth service

3. **Postman OAuth Helper (Web/Browser):**
   - `https://oauth.pstmn.io/v1/browser-callback`
   - Use this if you're using Postman's built-in OAuth helper (web version)
   - Requires registration with Postman OAuth service

4. **Your Application:**
   - Update `redirect_uri` to match your actual application callback URL
   - Must be registered in your PingOne application's redirect URIs list

### Important Notes

- **The redirect URI must be registered** in your PingOne application's redirect URIs list before it can be used
- **The redirect URI must match exactly** - no trailing slashes, case-sensitive
- **Application creation will fail** if `redirectUris` is empty or contains invalid URIs
- Pre-request scripts automatically validate and set a default redirect URI if not set

## Notes

- **Worker Token** is always included first in all collections as it's required for many operations
- **Use Cases** are organized by workflow steps (Environment Configuration → Configure Your Test User → Test The Workflow)
- **Unified OAuth/OIDC Flows** are organized by specification version, then by flow type, then by authentication method
- **MFA Flows** are organized by operation type (Registration vs Authentication), then by device type
- All requests include educational descriptions and variable extraction scripts
- Variables are automatically saved and can be referenced in subsequent requests using `{{variableName}}` syntax
- Worker credentials (`worker_client_id` and `worker_client_secret`) are always hardcoded and never overridden
- **Redirect URI** defaults to `https://localhost:3000/postman-callback` for Postman collection testing

---

## Last Updated

**Version:** 9.0.0  
**Date:** 2025-01-15

This document reflects the current structure generated by `src/services/postmanCollectionGeneratorV8.ts`. For the most up-to-date structure, refer to the generator code.

**Restore Note:** Once this structure is stable, this document will be used as the canonical reference for restoring Postman collection generation functionality if it regresses.
