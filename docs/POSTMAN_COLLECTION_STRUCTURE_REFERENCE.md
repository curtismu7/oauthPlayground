# Postman Collection Structure Reference

This document provides a complete reference of all groups, subgroups, and API calls in the PingOne Postman collections generated by OAuth Playground.

**Version:** Collections are versioned (e.g., `8.1.0`) to track changes and updates. Check the collection info for the current version when troubleshooting.

## Table of Contents

1. [Worker Token](#worker-token)
2. [Use Cases](#use-cases)
3. [Unified OAuth/OIDC Flows](#unified-oauthoidc-flows)
4. [MFA Flows](#mfa-flows)

---

## Worker Token

**Location:** Top-level folder (appears first in all collections)

**Purpose:** Server-to-server authentication tokens required for administrative operations

### Subgroups:

#### 1. Get Worker Token (Client Secret Post)
- **Get Worker Token** - POST request to obtain worker token using client_id and client_secret in request body

#### 2. Get Worker Token (Client Secret Basic)
- **Get Worker Token** - POST request to obtain worker token using HTTP Basic Authentication

#### 3. Get Worker Token (Client Secret JWT)
- **Get Worker Token** - POST request to obtain worker token using JWT assertion signed with client secret

#### 4. Get Worker Token (Private Key JWT)
- **Get Worker Token** - POST request to obtain worker token using JWT assertion signed with private key

---

## Use Cases

**Location:** Top-level folder (after Worker Token)

**Purpose:** Common customer identity flows for web applications

### Subgroups:

#### 1. Sign-up (Registration)
**Structure:** Setup → Register user → Test Registration

**Setup:**
- Step 1: Create a population for sign-up users
- Step 2: Create a group for sign-up users

**Register user:**
- Step 1: Create a user (with email verification) - Creates user with `VERIFICATION_REQUIRED` status
- Step 2: Verify User - Verifies user using verification code (OTP)
- Step 3: Set user password - Sets initial password for user
- Step 4: Add User to Group - Adds user to group

**Test Registration:**
- Lookup User by Username - Tests SCIM filter `username eq "value"`
- Lookup User by Email - Tests SCIM filter `email eq "user@example.com"`
- Lookup User by User ID - Direct lookup `GET /users/{userId}`

#### 2. Sign-in
**Structure:** Setup → Using Sign On Policy → Login → Test Login

**Setup:**
- Step 1: Create a web application for sign-in with PKCE
- Step 2: Get the application secret

**Using Sign On Policy:**
- Step 3: Create a sign-on policy
- Step 4: Create the login sign-on policy action
- Step 5: Assign the sign-on policy to the web application

**Login:**
- Step 1: Send an authorization request - Starts OAuth/OIDC flow (uses `response_mode=pi.flow` to return JSON flow response; no redirect required)
- Step 2: Lookup User by Username - Confirms user exists by username
- Step 3: Lookup User by Email - Confirms user exists by email
- Step 4: Submit login credentials - Submits username and password
- Step 5: Call the resume endpoint - Gets authorization code
- Step 6: Get the access token - Exchanges authorization code for tokens

**Test Login:**
- Get User Info - Calls OAuth UserInfo endpoint to verify login and retrieve user claims

#### 3. MFA Enrollment
**Structure:** Environment Configuration → Configure Your Test User → Test The Workflow

**Environment Configuration:**
- Step 1: Get Device Authentication Policies - Retrieves MFA policies

**Configure Your Test User:**
- Step 1: Lookup User by Username - Finds user by username to get userId

**Test The Workflow:**
- Step 1: Create SMS Device - Creates SMS MFA device with ACTIVATION_REQUIRED status
- Step 2: Activate Device with OTP - Activates device by verifying OTP code

#### 4. MFA Challenge
**Structure:** Environment Configuration → Test The Workflow

**Environment Configuration:**
- Step 1: Get Device Authentication Policies - Retrieves MFA policies

**Test The Workflow:**
- Step 1: Initialize Device Authentication - Starts MFA authentication process
- Step 2: Validate OTP Code - Validates OTP code from user's device
- Step 3: Complete Device Authentication - Finalizes MFA authentication

#### 5. Step-up Authentication
**Note:** Placeholder - combines re-authentication + sensitive action

#### 6. Forgot Password / Password Reset
**Structure:** Environment Configuration → Configure Your Test User → Test The Workflow

**Environment Configuration:**
- Step 1: Get Password Policies - Retrieves password policies

**Configure Your Test User:**
- Step 1: Lookup User by Email - Finds user by email address

**Test The Workflow:**
- Step 1: Request Password Reset - Initiates password reset flow
- Step 2: Verify Password Reset Code - Verifies reset code sent to user
- Step 3: Reset Password - Sets new password using reset code

#### 7. Account Recovery
**Structure:** Environment Configuration → Configure Your Test User → Test The Workflow

**Environment Configuration:**
- Step 1: Get Recovery Policies - Retrieves account recovery policies

**Configure Your Test User:**
- Step 1: Lookup User by Email - Finds user by email address

**Test The Workflow:**
- Step 1: Request Account Recovery - Initiates account recovery flow
- Step 2: Verify Recovery Code - Verifies recovery code sent to user
- Step 3: Complete Account Recovery - Completes recovery and resets MFA devices

#### 8. Change Credentials & Factors
**Structure:** Test The Workflow

**Test The Workflow:**
- Step 1: Change Password (Self-Service) - User changes their own password
- Step 2: Force Password Change (Admin) - Admin forces user to change password

#### 9. Social Login
**Structure:** Environment Configuration → Test The Workflow

**Environment Configuration:**
- Step 1: Configure Facebook IdP - Configures Facebook as external identity provider
- Step 2: Configure LinkedIn IdP - Configures LinkedIn as external identity provider

**Test The Workflow:**
- Step 1: Test Social Login Flow - Demonstrates social login authentication

#### 10. Partner / Enterprise Federation
**Structure:** Environment Configuration → Test The Workflow

**Environment Configuration:**
- Step 1: Configure Azure AD IdP - Configures Azure AD for enterprise federation

**Test The Workflow:**
- Step 1: Test Federation Flow - Demonstrates enterprise federation authentication

#### 11. OIDC/OAuth Login (Web app)
**Note:** Similar to Sign-in use case but focused on OIDC/OAuth specific flows

#### 12. Risk-based Checks
**Structure:** Environment Configuration → Test The Workflow

**Environment Configuration:**
- Step 1: Get Risk Predictors - Retrieves available risk predictors

**Test The Workflow:**
- Step 1: Create Risk Evaluation - Creates risk evaluation for user action
- Step 2: Update Risk Evaluation - Updates risk evaluation with results

#### 13. Logout
**Structure:** Test The Workflow

**Test The Workflow:**
- Step 1: List Active Sessions - Lists all active sessions for user
- Step 2: End Current Session - Ends the current user session
- Step 3: Revoke Token - Revokes access or refresh token
- Step 4: Verify Token Status - Verifies if token is still active

#### 14. User Sessions
**Structure:** Setup → User Sessions → Test

**Setup:**
- Step 1: Get Worker Token

**User Sessions:**
- Step 1: List All Sessions - Lists active sessions for user
- Step 2: Get Session Details - Fetches details for a specific session
- Step 3: Delete a Specific Session - Removes one session
- Step 4: Delete All Sessions - Removes all active sessions

**Test:**
- Step 6: Verify Sessions Deleted - Confirms sessions were removed

#### 15. Transaction Approval Flows
**Structure:** Transaction Approval - Redirect Flow → Transaction Approval - Non-redirect Flow

**Transaction Approval - Redirect Flow:**
- Step 1: Initiate Transaction Approval (Redirect) - Uses `login_hint_token` JWT and `response_mode=pi.flow` (returns JSON flow response with HTTP 200; no redirect required)

**Transaction Approval - Non-redirect Flow:**
- Step 1: Initiate Transaction Approval (Non-redirect) - POST request with form data using `login_hint_token` and `response_mode=pi.flow` (JSON response)

**Prerequisites:**
- `SignInUserID`, `SignInUsername`, `webAppSignInWithPKCEId`, `SignInWithPKCEAppSecret`
- Transaction variables: `transactionId`, `transactionAmount`, `transactionCurrency` (optional: `transactionDescription`, `SignInUserEmail`)

#### 16. PingOne Endpoints - Metadata
**Structure:** Metadata Endpoints

**Metadata Endpoints:**
- Step 1: OpenID Connect Discovery - `GET {{authPath}}/{{envID}}/.well-known/openid-configuration`
- Step 2: OAuth 2.0 Authorization Server Metadata - `GET {{authPath}}/{{envID}}/.well-known/oauth-authorization-server`
- Step 3: OAuth 2.0 Authorization Server Metadata (Custom Domain) - `GET {{customAuthPath}}/.well-known/oauth-authorization-server`
- Step 4: Read JWKS - `GET {{authPath}}/{{envID}}/as/jwks`
- Step 5: Pushed Authorization Request (CLIENT_SECRET_POST) - `POST {{authPath}}/{{envID}}/as/par`

**Prerequisites:**
- `authPath`, `envID`
- Optional: `customAuthPath` for custom domain metadata
- PAR: `webAppSignInWithPKCEId`, `SignInWithPKCEAppSecret`, `redirect_uri`, `codeChallenge`, `codeChallengeMethod`, `state`

---

## User Lookup Examples

The PingOne Platform API supports multiple ways to lookup users. All examples use the Management API endpoint with SCIM filter syntax.

### Documentation Reference
- **PingOne API Documentation:** [List Users with Filters](https://apidocs.pingidentity.com/pingone/platform/v1/api/#get-list-users)

### Lookup Methods

#### 1. Lookup by Username
**Endpoint:** `GET {{apiPath}}/v1/environments/{{envID}}/users?filter=username eq "value"`

**Example:**
```
GET {{apiPath}}/v1/environments/{{envID}}/users?filter=username eq "john_doe"
```

**Headers:**
- `Authorization: Bearer {{workerToken}}`
- `Accept: application/json`

**Response:**
- Returns users in `_embedded.users` array
- Username filter is case-sensitive and must match exactly

#### 2. Lookup by Email
**Endpoint:** `GET {{apiPath}}/v1/environments/{{envID}}/users?filter=email eq "value"`

**Example:**
```
GET {{apiPath}}/v1/environments/{{envID}}/users?filter=email eq "user@example.com"
```

**Notes:**
- `email` is a supported filter attribute in PingOne user search.
- Use `email` filter for reliable email lookups.

**Headers:**
- `Authorization: Bearer {{workerToken}}`
- `Accept: application/json`

**Response:**
- Returns users in `_embedded.users` array
- Email filter matches primary email address

#### 3. Lookup by User ID (Direct)
**Endpoint:** `GET {{apiPath}}/v1/environments/{{envID}}/users/{{userId}}`

**Example:**
```
GET {{apiPath}}/v1/environments/{{envID}}/users/66a4686b-9222-4ad2-91b6-03113711c9aa
```

**Headers:**
- `Authorization: Bearer {{workerToken}}`
- `Accept: application/json`

**Response:**
- Returns single user object directly (not wrapped in `_embedded.users`)
- Use this method when you already know the user ID (UUID format)
- More efficient than filter-based lookup for known user IDs

### Filter Syntax Notes
- Uses SCIM filter syntax (RFC 7644)
- String values must be enclosed in double quotes
- Filter parameter must be URL-encoded when used in query strings
- Case-sensitive matching for username filters
- Supports additional filter operators: `eq`, `ne`, `co`, `sw`, `ew`, `pr`, `gt`, `ge`, `lt`, `le`

### Common Use Cases
- **Sign-up flow:** Check if username/email already exists before creating account
- **Password reset:** Find user by email to send reset code
- **Account recovery:** Find user by email to initiate recovery
- **User management:** Retrieve user details by ID for admin operations

---

## Unified OAuth/OIDC Flows

**Location:** Top-level folder (after Worker Token, before MFA Flows)

**Purpose:** Comprehensive OAuth 2.0 and OpenID Connect flows organized by specification version

### Subgroups:

#### 1. OAuth 2.0 Authorization Framework (RFC 6749)
**Purpose:** Baseline OAuth framework standard (authorization without authentication)

**Flows Included:**

##### Authorization Code Flow (Client Secret Post)
- 1. Build Authorization URL
- 2. Exchange Authorization Code for Tokens
- 3. Use Access Token (Optional - Call UserInfo or API)

##### Authorization Code Flow (Client Secret Basic)
- 1. Build Authorization URL
- 2. Exchange Authorization Code for Tokens
- 3. Use Access Token (Optional - Call UserInfo or API)

##### Authorization Code Flow (Client Secret JWT)
- 1. Build Authorization URL
- 2. Exchange Authorization Code for Tokens
- 3. Use Access Token (Optional - Call UserInfo or API)

##### Authorization Code Flow (Private Key JWT)
- 1. Build Authorization URL
- 2. Exchange Authorization Code for Tokens
- 3. Use Access Token (Optional - Call UserInfo or API)

##### Authorization Code Flow (Form POST)
- 1. Build Authorization URL (Form POST response mode)
- 2. Exchange Authorization Code for Tokens
- 3. Use Access Token (Optional - Call UserInfo or API)

##### Client Credentials Flow
- Get Access Token

##### Device Code Flow
- 1. Request Device Authorization
- 2. Poll for Token (repeat until user authorizes)
- 3. Use Access Token (Optional - Call UserInfo or API)

##### Implicit Flow
- 1. Build Authorization URL (Implicit)
- 2. Parse Redirect Callback (Demonstration Step)
- 3. Use Access Token (Optional - Call UserInfo or API)

#### 2. OpenID Connect Core 1.0
**Purpose:** Authentication layer on top of OAuth 2.0 (adds ID tokens and user authentication)

**Flows Included:**

##### Authorization Code Flow with PKCE (Client Secret Post)
- 1. Generate PKCE Codes
- 2. Build Authorization URL
- 3. Exchange Authorization Code for Tokens
- 4. Decode ID Token
- 5. Use Access Token (Optional - Call UserInfo)

##### Authorization Code Flow with PKCE (Client Secret Basic)
- 1. Generate PKCE Codes
- 2. Build Authorization URL
- 3. Exchange Authorization Code for Tokens
- 4. Decode ID Token
- 5. Use Access Token (Optional - Call UserInfo)

##### Authorization Code Flow with PKCE (Client Secret JWT)
- 1. Generate PKCE Codes
- 2. Build Authorization URL
- 3. Exchange Authorization Code for Tokens
- 4. Decode ID Token
- 5. Use Access Token (Optional - Call UserInfo)

##### Authorization Code Flow with PKCE (Private Key JWT)
- 1. Generate PKCE Codes
- 2. Build Authorization URL
- 3. Exchange Authorization Code for Tokens
- 4. Decode ID Token
- 5. Use Access Token (Optional - Call UserInfo)

##### Authorization Code Flow with PKCE and PAR (Client Secret Post)
- 1. Generate PKCE Codes
- 2. Pushed Authorization Request (PAR)
- 3. Build Authorization URL (with request_uri)
- 4. Exchange Authorization Code for Tokens
- 5. Decode ID Token
- 6. Use Access Token (Optional - Call UserInfo)

##### Authorization Code Flow with PKCE and PAR (Client Secret Basic)
- 1. Generate PKCE Codes
- 2. Pushed Authorization Request (PAR)
- 3. Build Authorization URL (with request_uri)
- 4. Exchange Authorization Code for Tokens
- 5. Decode ID Token
- 6. Use Access Token (Optional - Call UserInfo)

##### Hybrid Flow
- 1. Build Authorization URL (Hybrid)
- 2. Parse Redirect Callback (Demonstration Step)
- 3. Exchange Authorization Code for Tokens
- 4. Decode ID Token
- 5. Use Access Token (Optional - Call UserInfo)

#### 3. OAuth 2.1 Authorization Framework (draft) with OpenID Connect Core 1.0
**Purpose:** Consolidated OAuth specification (IETF draft) with modern security practices (PKCE required)

**Flows Included:**

##### Authorization Code Flow with PKCE (Client Secret Post)
- 1. Generate PKCE Codes
- 2. Build Authorization URL
- 3. Exchange Authorization Code for Tokens
- 4. Decode ID Token
- 5. Use Access Token (Optional - Call UserInfo)

##### Authorization Code Flow with PKCE (Client Secret Basic)
- 1. Generate PKCE Codes
- 2. Build Authorization URL
- 3. Exchange Authorization Code for Tokens
- 4. Decode ID Token
- 5. Use Access Token (Optional - Call UserInfo)

##### Authorization Code Flow with PKCE and PAR (Client Secret Post)
- 1. Generate PKCE Codes
- 2. Pushed Authorization Request (PAR)
- 3. Build Authorization URL (with request_uri)
- 4. Exchange Authorization Code for Tokens
- 5. Decode ID Token
- 6. Use Access Token (Optional - Call UserInfo)

##### Authorization Code Flow with PKCE and PAR (Client Secret Basic)
- 1. Generate PKCE Codes
- 2. Pushed Authorization Request (PAR)
- 3. Build Authorization URL (with request_uri)
- 4. Exchange Authorization Code for Tokens
- 5. Decode ID Token
- 6. Use Access Token (Optional - Call UserInfo)

**Note:** OAuth 2.1 does not support Implicit Flow or Client Credentials Flow in the same way as OAuth 2.0

#### 4. Redirectless (PingOne pi.flow)
**Purpose:** PingOne-specific redirectless authentication flow

**Flows Included:**

##### Redirectless Authentication Flow
- 1. Initialize Redirectless Flow
- 2. Authenticate User (Username/Password)
- 3. Handle MFA (if required)
- 4. Complete Flow and Get Tokens
- 5. Use Access Token (Optional - Call UserInfo)

---

## MFA Flows

**Location:** Top-level folder (after Unified OAuth/OIDC Flows)

**Purpose:** Multi-factor authentication device registration and authentication flows

### Subgroups:

#### 1. Registration
**Purpose:** Register MFA devices for users

**Device Types (each with their own subgroup):**

##### SMS
- Create SMS Device (Admin Flow - ACTIVE status)
- Create SMS Device (User Flow - ACTIVATION_REQUIRED status)
- Activate SMS Device (with OTP)
- Resend OTP Code

##### EMAIL
- Create Email Device (Admin Flow - ACTIVE status)
- Create Email Device (User Flow - ACTIVATION_REQUIRED status)
- Activate Email Device (with OTP)
- Resend OTP Code

##### WHATSAPP
- Create WhatsApp Device (Admin Flow - ACTIVE status)
- Create WhatsApp Device (User Flow - ACTIVATION_REQUIRED status)
- Activate WhatsApp Device (with OTP)
- Resend OTP Code

##### TOTP (OATH TOTP - RFC 6238)
- Create TOTP Device (Admin Flow - ACTIVE status)
- Create TOTP Device (User Flow - ACTIVATION_REQUIRED status)
- Activate TOTP Device (with OTP)
- Get TOTP QR Code (for manual entry)

##### FIDO2
- Create FIDO2 Device (Admin Flow - ACTIVE status)
- Create FIDO2 Device (User Flow - ACTIVATION_REQUIRED status)
- Initialize FIDO2 Registration
- Complete FIDO2 Registration

##### MOBILE
- Create Mobile Device (Admin Flow - ACTIVE status)
- Create Mobile Device (User Flow - ACTIVATION_REQUIRED status)
- Activate Mobile Device (with OTP)
- Resend OTP Code

#### 2. Authentication
**Purpose:** Authenticate users using MFA devices

**Device Types (each with their own subgroup):**

##### SMS
- Initialize Device Authentication
- Validate OTP Code
- Complete Device Authentication

##### EMAIL
- Initialize Device Authentication
- Validate OTP Code
- Complete Device Authentication

##### WHATSAPP
- Initialize Device Authentication
- Validate OTP Code
- Complete Device Authentication

##### TOTP (OATH TOTP - RFC 6238)
- Initialize Device Authentication
- Validate OTP Code
- Complete Device Authentication

##### FIDO2
- Initialize Device Authentication
- Complete FIDO2 Authentication (with assertion)

##### MOBILE
- Initialize Device Authentication
- Validate OTP Code
- Complete Device Authentication

---

## Collection Types

Collections can be generated in different combinations:

1. **Use Cases Only** - Worker Token + Use Cases
2. **Unified Only** - Worker Token + Unified OAuth/OIDC Flows
3. **MFA Only** - Worker Token + MFA Flows
4. **Complete (Unified + MFA)** - Worker Token + Unified OAuth/OIDC Flows + MFA Flows
5. **Complete (All)** - Worker Token + Use Cases + Unified OAuth/OIDC Flows + MFA Flows

---

## Notes

- **Worker Token** is always included first in all collections as it's required for many operations
- **Use Cases** are organized by workflow steps (Environment Configuration → Configure Your Test User → Test The Workflow)
- **Unified OAuth/OIDC Flows** are organized by specification version, then by flow type, then by authentication method
- **MFA Flows** are organized by operation type (Registration vs Authentication), then by device type
- All requests include educational descriptions and variable extraction scripts
- Variables are automatically saved and can be referenced in subsequent requests using `{{variableName}}` syntax

---

## Last Updated

This document was generated from the Postman collection generator codebase. For the most up-to-date structure, refer to `src/services/postmanCollectionGeneratorV8.ts`.
