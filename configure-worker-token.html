<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure Worker Token Flow</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        .config-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .credential {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
        }
        .credential label {
            font-weight: 600;
            min-width: 150px;
            margin-right: 1rem;
        }
        .credential input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        .credential button {
            margin-left: 0.5rem;
            padding: 0.5rem 1rem;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .credential button:hover {
            background: #0056b3;
        }
        .status {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>üîß Configure Worker Token Flow</h1>
    <p>This page will configure the Worker Token flow with your PingOne application credentials.</p>

    <div class="config-section">
        <h2>PingOne Application Credentials</h2>
        <div class="credential">
            <label>Environment ID:</label>
            <input type="text" id="environmentId" value="b9817c16-9910-4415-b67e-4ac687da74d9" readonly>
            <button onclick="copyToClipboard('environmentId')">Copy</button>
        </div>
        <div class="credential">
            <label>Client ID:</label>
            <input type="text" id="clientId" value="66a4686b-9222-4ad2-91b6-03113711c9aa" readonly>
            <button onclick="copyToClipboard('clientId')">Copy</button>
        </div>
        <div class="credential">
            <label>Client Secret:</label>
            <input type="password" id="clientSecret" value="oihV6umR6VD-kFt~Ykb0jyHQhxcpHw49zcCk-Q7pjJpUGX3NQ5~.Ge4WKRCKUtrN">
            <button onclick="toggleSecret('clientSecret')">üëÅÔ∏è</button>
            <button onclick="copyToClipboard('clientSecret')">Copy</button>
        </div>
    </div>

    <div class="config-section">
        <h2>OIDC Settings</h2>
        <div class="credential">
            <label>Token Auth Method:</label>
            <input type="text" value="Client Secret Post" readonly>
        </div>
        <div class="credential">
            <label>Grant Type:</label>
            <input type="text" value="Client Credentials" readonly>
        </div>
        <div class="credential">
            <label>Response Type:</label>
            <input type="text" value="None Specified" readonly>
        </div>
    </div>

    <div class="config-section">
        <button onclick="configureWorkerToken()" style="padding: 1rem 2rem; font-size: 1.1rem; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
            üöÄ Configure Worker Token Flow
        </button>
    </div>

    <div id="status"></div>

    <script>
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999); // For mobile devices
            document.execCommand('copy');
            
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úì Copied!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        }

        function toggleSecret(elementId) {
            const element = document.getElementById(elementId);
            const button = event.target;
            
            if (element.type === 'password') {
                element.type = 'text';
                button.textContent = 'üôà';
            } else {
                element.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function configureWorkerToken() {
            try {
                console.log('üîß [WORKER-TOKEN] Starting configuration...');
                
                // Get credentials from the form
                const environmentId = document.getElementById('environmentId').value;
                const clientId = document.getElementById('clientId').value;
                const clientSecret = document.getElementById('clientSecret').value;

                if (!environmentId || !clientId || !clientSecret) {
                    throw new Error('All credentials are required');
                }

                // Worker Token configuration
                const workerTokenConfig = {
                    environmentId: environmentId,
                    clientId: clientId,
                    clientSecret: clientSecret,
                    tokenAuthMethod: 'client_secret_post',
                    redirectUri: '',
                    scopes: 'api:read',
                    pkceEnabled: false,
                    updatedAt: Date.now()
                };

                console.log('üìã [WORKER-TOKEN] Configuration:', {
                    environmentId: workerTokenConfig.environmentId,
                    clientId: workerTokenConfig.clientId,
                    hasClientSecret: !!workerTokenConfig.clientSecret,
                    tokenAuthMethod: workerTokenConfig.tokenAuthMethod
                });

                // Store the configuration in localStorage
                const flowConfigKey = 'p1_import_tool.v2.config.flow.worker_token';
                localStorage.setItem(flowConfigKey, JSON.stringify(workerTokenConfig));
                
                console.log('‚úÖ [WORKER-TOKEN] Worker Token flow configuration saved successfully');

                // Also update the global config if it doesn't exist
                const globalConfigKey = 'p1_import_tool.v2.config.global';
                const existingGlobalConfig = localStorage.getItem(globalConfigKey);
                
                if (!existingGlobalConfig) {
                    const globalConfig = {
                        environmentId: workerTokenConfig.environmentId,
                        clientId: workerTokenConfig.clientId,
                        clientSecret: workerTokenConfig.clientSecret,
                        tokenAuthMethod: workerTokenConfig.tokenAuthMethod,
                        redirectUri: window.location.origin + '/callback',
                        scopes: 'openid profile email',
                        pkceEnabled: true,
                        updatedAt: Date.now(),
                        authEndpoint: `https://auth.pingone.com/${workerTokenConfig.environmentId}/as/authorize`,
                        tokenEndpoint: `https://auth.pingone.com/${workerTokenConfig.environmentId}/as/token`,
                        userInfoEndpoint: `https://auth.pingone.com/${workerTokenConfig.environmentId}/as/userinfo`,
                        applicationType: 'backend',
                        jwksMethod: 'jwks_url',
                        jwksUrl: '',
                        jwks: '',
                        requirePar: false,
                        parTimeout: 60,
                        accessTokenLifetime: 60,
                        refreshTokenLifetime: 10080,
                        idTokenLifetime: 60,
                        allowedOrigins: [window.location.origin]
                    };
                    
                    localStorage.setItem(globalConfigKey, JSON.stringify(globalConfig));
                    console.log('‚úÖ [WORKER-TOKEN] Global configuration also created');
                }

                showStatus(`
                    <h3>‚úÖ Configuration Complete!</h3>
                    <p><strong>Worker Token flow has been configured successfully with your PingOne credentials.</strong></p>
                    <ul>
                        <li>Environment ID: <code>${environmentId}</code></li>
                        <li>Client ID: <code>${clientId}</code></li>
                        <li>Token Auth Method: <code>client_secret_post</code></li>
                        <li>Grant Type: <code>client_credentials</code></li>
                    </ul>
                    <p><strong>Next steps:</strong></p>
                    <ol>
                        <li>Navigate to the OAuth Playground application</li>
                        <li>Go to OpenID Connect ‚Üí Worker Token</li>
                        <li>Test the flow with your configured credentials</li>
                    </ol>
                `, 'success');

            } catch (error) {
                console.error('‚ùå [WORKER-TOKEN] Configuration failed:', error);
                showStatus(`
                    <h3>‚ùå Configuration Failed</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Please check the browser console for more details.</p>
                `, 'error');
            }
        }

        // Show initial status
        showStatus(`
            <h3>‚ÑπÔ∏è Ready to Configure</h3>
            <p>Click the "Configure Worker Token Flow" button above to save your PingOne credentials to the OAuth Playground application.</p>
            <p><strong>Note:</strong> This will store the configuration in your browser's localStorage.</p>
        `, 'info');
    </script>
</body>
</html>


