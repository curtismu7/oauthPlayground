<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Authorization Debug Tool</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f9fafb;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 1rem;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        button:hover {
            background: #2563eb;
        }
        .result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }
        .error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }
        .info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Device Authorization Debug Tool</h1>
        <p>This tool helps debug device authorization flow issues by testing the device code request and verification URL generation.</p>
        
        <div class="form-group">
            <label for="environmentId">Environment ID:</label>
            <input type="text" id="environmentId" value="test" placeholder="Enter your PingOne Environment ID">
        </div>
        
        <div class="form-group">
            <label for="clientId">Client ID:</label>
            <input type="text" id="clientId" value="test" placeholder="Enter your PingOne Client ID">
        </div>
        
        <div class="form-group">
            <label for="clientSecret">Client Secret (optional):</label>
            <input type="text" id="clientSecret" placeholder="Enter your PingOne Client Secret (if confidential client)">
        </div>
        
        <div class="form-group">
            <label for="scopes">Scopes:</label>
            <input type="text" id="scopes" value="openid profile email" placeholder="Enter requested scopes">
        </div>
        
        <button onclick="testDeviceAuth()">Test Device Authorization</button>
        
        <div id="result"></div>
    </div>

    <script>
        async function testDeviceAuth() {
            const environmentId = document.getElementById('environmentId').value;
            const clientId = document.getElementById('clientId').value;
            const clientSecret = document.getElementById('clientSecret').value;
            const scopes = document.getElementById('scopes').value;
            const resultDiv = document.getElementById('result');
            
            if (!environmentId || !clientId) {
                resultDiv.innerHTML = '<div class="result error">Please enter Environment ID and Client ID</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="result info">Testing device authorization...</div>';
            
            try {
                // Test device code request
                const deviceAuthEndpoint = `https://auth.pingone.com/${environmentId}/as/device_authorization`;
                
                const params = new URLSearchParams({
                    client_id: clientId,
                    scope: scopes || 'openid',
                });
                
                if (clientSecret) {
                    params.append('client_secret', clientSecret);
                }
                
                console.log('Device Auth Endpoint:', deviceAuthEndpoint);
                console.log('Request params:', params.toString());
                
                const response = await fetch(deviceAuthEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: params.toString(),
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const verificationUrl = data.verification_uri_complete || `${data.verification_uri}?user_code=${data.user_code}`;
                    
                    resultDiv.innerHTML = `
                        <div class="result success">
‚úÖ Device Code Request Successful!

Environment ID: ${environmentId}
Client ID: ${clientId}
Device Code: ${data.device_code.substring(0, 20)}...
User Code: ${data.user_code}
Verification URI: ${data.verification_uri}
Verification URI Complete: ${verificationUrl}
Expires In: ${data.expires_in} seconds
Polling Interval: ${data.interval} seconds

üîó Click this link to test verification:
<a href="${verificationUrl}" target="_blank">${verificationUrl}</a>

‚ö†Ô∏è  If you get "invalid activation code" error, check:
1. Environment ID matches between device code request and verification
2. Client ID is correctly configured in PingOne
3. The application is properly set up in PingOne console
4. Test credentials are valid and not expired
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
‚ùå Device Code Request Failed

Status: ${response.status} ${response.statusText}
Error: ${data.error || 'Unknown error'}
Description: ${data.error_description || 'No description provided'}

Common issues:
1. Invalid Environment ID
2. Invalid Client ID  
3. Client not configured for Device Authorization Flow
4. Missing required scopes
5. CORS issues (try from localhost:3000)
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
‚ùå Request Failed

Error: ${error.message}

This might be a CORS issue. Try running this from the OAuth Playground application instead.
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
