<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Credential Loading</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Credential Loading</h1>
        <p>This test verifies that credentials are loaded correctly from the new separate storage system.</p>
        
        <div class="test-section info">
            <h3>Test Configuration</h3>
            <p>Testing that credentials are loaded from the correct storage keys.</p>
        </div>

        <div class="test-section">
            <h3>Test Actions</h3>
            <button onclick="testCredentialLoading()">Test Credential Loading</button>
            <button onclick="clearTestData()">Clear Test Data</button>
            <button onclick="showCurrentStorage()">Show Current Storage</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // Test credentials
        const testConfigCredentials = {
            environmentId: 'config-env-123',
            clientId: 'config-client-456',
            redirectUri: 'https://example.com/dashboard-callback',
            scopes: ['openid', 'profile', 'email'],
            authEndpoint: 'https://auth.pingone.com/config-env-123/as/authorize',
            tokenEndpoint: 'https://auth.pingone.com/config-env-123/as/token',
            userInfoEndpoint: 'https://auth.pingone.com/config-env-123/as/userinfo'
        };

        const testAuthzFlowCredentials = {
            environmentId: 'authz-env-789',
            clientId: 'authz-client-012',
            redirectUri: 'https://example.com/authz-callback',
            scopes: ['openid', 'profile', 'email', 'offline_access'],
            authEndpoint: 'https://auth.pingone.com/authz-env-789/as/authorize',
            tokenEndpoint: 'https://auth.pingone.com/authz-env-789/as/token',
            userInfoEndpoint: 'https://auth.pingone.com/authz-env-789/as/userinfo'
        };

        // Test localStorage keys
        const CONFIG_CREDENTIALS_KEY = 'pingone_config_credentials';
        const AUTHZ_FLOW_CREDENTIALS_KEY = 'pingone_authz_flow_credentials';

        function testCredentialLoading() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="test-section info"><h3>Testing Credential Loading...</h3></div>';

            try {
                console.log('üß™ Testing credential loading...');

                // Save test credentials
                localStorage.setItem(CONFIG_CREDENTIALS_KEY, JSON.stringify({
                    ...testConfigCredentials,
                    lastUpdated: Date.now()
                }));

                localStorage.setItem(AUTHZ_FLOW_CREDENTIALS_KEY, JSON.stringify({
                    ...testAuthzFlowCredentials,
                    lastUpdated: Date.now()
                }));

                // Test loading logic (simulating the app's logic)
                let configCreds = JSON.parse(localStorage.getItem(CONFIG_CREDENTIALS_KEY) || '{}');
                let authzCreds = JSON.parse(localStorage.getItem(AUTHZ_FLOW_CREDENTIALS_KEY) || '{}');

                // Simulate the app's loading logic
                let allCredentials = authzCreds;
                if (!allCredentials.environmentId && !allCredentials.clientId) {
                    allCredentials = configCreds;
                }

                let resultHtml = '<div class="test-section ' + (allCredentials.environmentId ? 'success' : 'error') + '">';
                resultHtml += '<h3>' + (allCredentials.environmentId ? '‚úÖ SUCCESS' : '‚ùå FAILURE') + '</h3>';
                
                if (allCredentials.environmentId) {
                    resultHtml += '<p><strong>Credentials loaded successfully!</strong></p>';
                    resultHtml += '<ul>';
                    resultHtml += '<li>Environment ID: ' + allCredentials.environmentId + '</li>';
                    resultHtml += '<li>Client ID: ' + allCredentials.clientId + '</li>';
                    resultHtml += '<li>Redirect URI: ' + allCredentials.redirectUri + '</li>';
                    resultHtml += '</ul>';
                } else {
                    resultHtml += '<p><strong>No credentials found!</strong></p>';
                }

                resultHtml += '<h4>Config Credentials:</h4>';
                resultHtml += '<pre>' + JSON.stringify(configCreds, null, 2) + '</pre>';

                resultHtml += '<h4>Authz Flow Credentials:</h4>';
                resultHtml += '<pre>' + JSON.stringify(authzCreds, null, 2) + '</pre>';

                resultHtml += '<h4>Selected Credentials:</h4>';
                resultHtml += '<pre>' + JSON.stringify(allCredentials, null, 2) + '</pre>';

                resultHtml += '</div>';

                resultsDiv.innerHTML = resultHtml;

            } catch (error) {
                console.error('Test failed:', error);
                resultsDiv.innerHTML = '<div class="test-section error"><h3>‚ùå Test Failed</h3><p>Error: ' + error.message + '</p></div>';
            }
        }

        function clearTestData() {
            localStorage.removeItem(CONFIG_CREDENTIALS_KEY);
            localStorage.removeItem(AUTHZ_FLOW_CREDENTIALS_KEY);
            document.getElementById('results').innerHTML = '<div class="test-section info"><h3>Test data cleared</h3></div>';
        }

        function showCurrentStorage() {
            const pingoneKeys = Object.keys(localStorage).filter(key => key.includes('pingone'));
            let html = '<div class="test-section info"><h3>Current PingOne Storage Keys</h3>';
            html += '<ul>';
            pingoneKeys.forEach(key => {
                const value = localStorage.getItem(key);
                html += '<li><strong>' + key + ':</strong> <pre>' + (value ? JSON.stringify(JSON.parse(value), null, 2) : 'null') + '</pre></li>';
            });
            html += '</ul></div>';
            document.getElementById('results').innerHTML = html;
        }
    </script>
</body>
</html>
